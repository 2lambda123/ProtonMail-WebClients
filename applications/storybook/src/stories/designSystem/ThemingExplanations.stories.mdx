import { Meta, Source } from '@storybook/addon-docs';
import themeDefaultSvg from '@proton/styles/assets/img/themes/theme-default.svg';
import { Alert } from '@proton/components';

<Meta title="Design System / Theming / Explanations" />

# Applications theming

## Context

It can be difficult to add a theming mechanism to a design system without duplication. With this in mind, we have taken an approach which aims to minimize duplication by **moving all references of what can be themeable into theming files outside of the design system**.

Each [_theme file_](https://gitlab.protontech.ch/web/clients/-/tree/main/packages/styles/scss/themes) defines the values that can be themeable (colors, radius, shadow spread, font faces, etc.) which can be predetermined or customized by the user. Hence, theming is achieved by switching between these theme files.

## Standard and Prominent layout

The applications interface is separated into 2 sections: the **main** section and the **header/navigation** section.

Since the default theme uses different text and background colors in these sections, it makes sense to separate them in the theming files too.

<figure className="text-center">
    <img className="shadow-lifted w25" src={themeDefaultSvg} alt="Proton default theme" />
    <figcaption className="text-sm mt0-5 mb0 text-italic">Proton default theme</figcaption>
</figure>

To do this we use `.ui-standard` for the main section styles and `.ui-prominent` for the header/navigation section styles.

To avoid the performance and maintainability nightmare of having to redefine each variable for each ui section, `.ui-prominent` is defined as an override of `.ui-standard`. This means each variable defined in `.ui-standard` is already defined in `.ui-prominent`.

_Variables should not be **redefined** inside of `.ui-prominent`, but **overridden** instead._

```css
:root,
.ui-standard {
    --css-variable: value;
}
.ui-prominent {
    --css-variable: overrided-value;
}
```

`:root` is defined with `.ui-standard` then `.ui-prominent` is defined, giving us a mechanism to define a section as prominent and one of its children as standard.

This is useful in some cases. For example, if we want a section to share the prominent styling, such as the title bar of the mail composer, we simply add the `ui-prominent` class to it.

## Variable abstraction layer

Each variable can be **used anywhere in the design system** in many contexts of use, meaning the naming of variables is abstracted. For example, the variable name referring to a color **must not refer to the color itself**, but to an **abstraction of the color**. This applies to any other themeable property.

**This abstraction layer is the basis of theming management** and must be carefully gatekept.

```css
:root,
.ui-standard {
    --text-norm: #262a33;
    --background-norm: white;
}
.ui-prominent {
    --text-norm: white;
    --background-norm: #1c223d;
}
```

<Alert type="info">
    These variables should not be defined by anyone other than the design team in collaboration with the core team. If
    you think a variable is missing, please refer it to them.
</Alert>

To the attention of the design team and the core team: if you think you need to add a new variable or variable group, **challenge it strongly first**. The idea is to avoid any usage duplication and the addition of too many variables resulting in the theming files being hard to maintain.

## Optionals

We use CSS custom properties, as well known as CSS variables, to achieve that theming mechanism. Since CSS `var()` gives the oportunity to add **one or several fallback values**, we are able to tell that if the value we are refering to doesn't exist, it takes another one instead.

That means the first one can be handled as **an optional contextual themable value**.

```css
selector {
    property: var(--optional-var, var(--fallback-var));
}
```

Optional variables are created for **two purposes**:

-   making skilled users able to modify a theme as they want pretty easily,
-   or making us able to adapt any property in a specific case that needs to be changed on switching to specific themes.

For example, we had to add some optional variables for read and unread email items to adapt their background and text colors, because the visual difference between them wasn't obvious enough specifically on dark themes.

Optional variables are usually used for one and only situation, so it makes sense that an optional variable name refers to a specific context. That variable name must be **the most descriptive as possible to understand the context of use**, and the impacted property at the end, using train-case naming convention.

```css
&.unread {
    color: var(--email-item-unread-text-color);
}
```

**All optional variables are defined in a dedicated mapping file**, at [_packages/styles/scss/base/custom-properties/\_optionals.scss_](https://gitlab.protontech.ch/web/clients/-/blob/main/packages/styles/scss/base/custom-properties/_optionals.scss), for maintanability purpose. This way, we can see all optional variables in one and only place, and **it creates a layer to have `--optional` prefixed names for theme files**, which makes those variables quickly understandable as optionals for the design team.

```css
:root,
.ui-standard,
.ui-prominent {
    --email-item-unread-text-color: var(--optional-email-item-unread-text-color, var(--text-norm));
}
```

---

**[Next step, usage &rarr;](?path=/docs/design-system-theming-usage--page)**
